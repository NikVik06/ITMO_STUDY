// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Nullable from "../Data.Nullable/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as Effect_Console from "../Effect.Console/index.js";
import * as Effect_Ref from "../Effect.Ref/index.js";
import * as Web_DOM_Document from "../Web.DOM.Document/index.js";
import * as Web_DOM_Element from "../Web.DOM.Element/index.js";
import * as Web_DOM_NodeList from "../Web.DOM.NodeList/index.js";
import * as Web_DOM_NonElementParentNode from "../Web.DOM.NonElementParentNode/index.js";
import * as Web_DOM_ParentNode from "../Web.DOM.ParentNode/index.js";
import * as Web_Event_EventTarget from "../Web.Event.EventTarget/index.js";
import * as Web_HTML from "../Web.HTML/index.js";
import * as Web_HTML_HTMLDocument from "../Web.HTML.HTMLDocument/index.js";
import * as Web_HTML_HTMLInputElement from "../Web.HTML.HTMLInputElement/index.js";
import * as Web_HTML_Window from "../Web.HTML.Window/index.js";
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(Data_Either.bindEither);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Either.applicativeEither);
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var eq = /* #__PURE__ */ Data_Eq.eq(/* #__PURE__ */ Data_Eq.eqArray(Data_Eq.eqNumber));
var pure1 = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var traverse_ = /* #__PURE__ */ Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableArray);
var bind2 = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var $$void = /* #__PURE__ */ Data_Functor["void"](Effect.functorEffect);
var bindFlipped = /* #__PURE__ */ Control_Bind.bindFlipped(Effect.bindEffect);
var nub = /* #__PURE__ */ Data_Array.nub(Data_Ord.ordNumber);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var showRecord = /* #__PURE__ */ Data_Show.showRecord()();
var showRecordFieldsCons = /* #__PURE__ */ Data_Show.showRecordFieldsCons({
    reflectSymbol: function () {
        return "r";
    }
});
var showRecordFieldsCons1 = /* #__PURE__ */ Data_Show.showRecordFieldsCons({
    reflectSymbol: function () {
        return "x";
    }
});
var showRecordFieldsConsNil = /* #__PURE__ */ Data_Show.showRecordFieldsConsNil({
    reflectSymbol: function () {
        return "y";
    }
});
var showArray = /* #__PURE__ */ Data_Show.showArray(Data_Show.showNumber);
var show2 = /* #__PURE__ */ Data_Show.show(/* #__PURE__ */ showRecord(/* #__PURE__ */ showRecordFieldsCons(/* #__PURE__ */ showRecordFieldsCons1(/* #__PURE__ */ showRecordFieldsConsNil(/* #__PURE__ */ Data_Maybe.showMaybe(Data_Show.showNumber)))(Data_Show.showNumber))(showArray)));
var show3 = /* #__PURE__ */ Data_Show.show(/* #__PURE__ */ showRecord(/* #__PURE__ */ showRecordFieldsCons(/* #__PURE__ */ showRecordFieldsCons1(/* #__PURE__ */ showRecordFieldsConsNil(Data_Show.showNumber))(Data_Show.showNumber))(showArray)));
var for_ = /* #__PURE__ */ Data_Foldable.for_(Effect.applicativeEffect)(Data_Foldable.foldableArray);
var validateState = function (state) {
    return discard1((function () {
        var $65 = state.x < -5.0 || state.x > 3.0;
        if ($65) {
            return new Data_Either.Left("X \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 \u043e\u0442 -5 \u0434\u043e 3");
        };
        return pure(Data_Unit.unit);
    })())(function () {
        return bind((function () {
            if (state.y instanceof Data_Maybe.Just) {
                return new Data_Either.Right(state.y.value0);
            };
            if (state.y instanceof Data_Maybe.Nothing) {
                return new Data_Either.Left("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 Y");
            };
            throw new Error("Failed pattern match at Main (line 206, column 8 - line 208, column 42): " + [ state.y.constructor.name ]);
        })())(function (y) {
            return discard1((function () {
                var $68 = eq(state.r)([  ]);
                if ($68) {
                    return new Data_Either.Left("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 R");
                };
                return pure(Data_Unit.unit);
            })())(function () {
                return new Data_Either.Right({
                    x: state.x,
                    y: y,
                    r: state.r
                });
            });
        });
    });
};
var textContent = function (node) {
    return function __do() {
        var content = $foreign["_textContent"](node)();
        return Data_Maybe.fromMaybe("")(content);
    };
};
var saveResult = function (result) {
    return function __do() {
        var current = $foreign.getItem("results")();
        var currentArray = (function () {
            var v = Data_Nullable.toMaybe(current);
            if (v instanceof Data_Maybe.Nothing) {
                return [  ];
            };
            if (v instanceof Data_Maybe.Just) {
                return Data_Maybe.fromMaybe([  ])($foreign.parseResults(v.value0));
            };
            throw new Error("Failed pattern match at Main (line 147, column 22 - line 149, column 54): " + [ v.constructor.name ]);
        })();
        var newArray = Data_Array.cons(result)(currentArray);
        $foreign.setItem("results")($foreign.stringify(newArray))();
        return Effect_Console.log("\ud83d\udcbe \u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d \u0432 localStorage")();
    };
};
var safeRestoreHistory = function (json) {
    return function __do() {
        var count = $foreign.safeParseAndDisplay(json)();
        var $71 = count > 0;
        if ($71) {
            return Effect_Console.log("\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e " + (show(count) + " \u0437\u0430\u043f\u0438\u0441\u0435\u0439"))();
        };
        return Effect_Console.log("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e")();
    };
};
var restoreHistory = function __do() {
    Effect_Console.log("PureScript: \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0438\u0441\u0442\u043e\u0440\u0438\u044e...")();
    var resultsJson = $foreign.getItem("results")();
    var v = Data_Nullable.toMaybe(resultsJson);
    if (v instanceof Data_Maybe.Nothing) {
        return Effect_Console.log("\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430")();
    };
    if (v instanceof Data_Maybe.Just) {
        Effect_Console.log("\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u044b \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 localStorage, \u0434\u043b\u0438\u043d\u0430: " + (show(Data_String_CodePoints.length(v.value0)) + " chars"))();
        return safeRestoreHistory(v.value0)();
    };
    throw new Error("Failed pattern match at Main (line 158, column 3 - line 162, column 30): " + [ v.constructor.name ]);
};
var parseNumber = function (str) {
    return Data_Number.fromString(str);
};
var initYButtons = function (appStateRef) {
    return function (doc) {
        return function __do() {
            var nodeList = Web_DOM_ParentNode.querySelectorAll(".y-btn")(Web_DOM_Document.toParentNode(doc))();
            var nodes = Web_DOM_NodeList.toArray(nodeList)();
            var buttons = Data_Array.mapMaybe(Web_DOM_Element.fromNode)(nodes);
            Effect_Console.log("\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u043a\u043d\u043e\u043f\u043e\u043a Y: " + show(Data_Array.length(buttons)))();
            return traverse_(function (btnElement) {
                return function __do() {
                    var listener = Web_Event_EventTarget.eventListener(function (v) {
                        return function __do() {
                            var allButtons = Web_DOM_ParentNode.querySelectorAll(".y-btn")(Web_DOM_Document.toParentNode(doc))();
                            var allButtonsNodes = Web_DOM_NodeList.toArray(allButtons)();
                            var allButtonsElements = Data_Array.mapMaybe(Web_DOM_Element.fromNode)(allButtonsNodes);
                            traverse_(function (b) {
                                return function __do() {
                                    Web_DOM_Element.setAttribute("style")("")(b)();
                                    return Web_DOM_Element.setAttribute("active")("false")(b)();
                                };
                            })(allButtonsElements)();
                            Web_DOM_Element.setAttribute("style")("background-color: #3498db; color: white;")(btnElement)();
                            Web_DOM_Element.setAttribute("active")("true")(btnElement)();
                            var maybeVal = Web_DOM_Element.getAttribute("data-value")(btnElement)();
                            var v1 = bind2(maybeVal)(parseNumber);
                            if (v1 instanceof Data_Maybe.Nothing) {
                                var btnText = textContent(Web_DOM_Element.toNode(btnElement))();
                                var v2 = parseNumber(btnText);
                                if (v2 instanceof Data_Maybe.Nothing) {
                                    return Effect_Console.log("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0440\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 Y: " + btnText)();
                                };
                                if (v2 instanceof Data_Maybe.Just) {
                                    Effect_Ref.modify_(function (v3) {
                                        return {
                                            r: v3.r,
                                            x: v3.x,
                                            y: new Data_Maybe.Just(v2.value0)
                                        };
                                    })(appStateRef)();
                                    return Effect_Console.log("Selected Y = " + show1(v2.value0))();
                                };
                                throw new Error("Failed pattern match at Main (line 106, column 11 - line 110, column 49): " + [ v2.constructor.name ]);
                            };
                            if (v1 instanceof Data_Maybe.Just) {
                                Effect_Ref.modify_(function (v2) {
                                    return {
                                        r: v2.r,
                                        x: v2.x,
                                        y: new Data_Maybe.Just(v1.value0)
                                    };
                                })(appStateRef)();
                                return Effect_Console.log("Selected Y = " + show1(v1.value0))();
                            };
                            throw new Error("Failed pattern match at Main (line 103, column 7 - line 113, column 45): " + [ v1.constructor.name ]);
                        };
                    })();
                    return $$void(Web_Event_EventTarget.addEventListener("click")(listener)(false)(Web_DOM_Element.toEventTarget(btnElement)))();
                };
            })(buttons)();
        };
    };
};
var initXInput = function (appStateRef) {
    return function __do() {
        var htmlDoc = bindFlipped(Web_HTML_Window.document)(Web_HTML.window)();
        var maybeElement = Web_DOM_NonElementParentNode.getElementById("x")(Web_HTML_HTMLDocument.toNonElementParentNode(htmlDoc))();
        if (maybeElement instanceof Data_Maybe.Nothing) {
            return Effect_Console.log("x input not found")();
        };
        if (maybeElement instanceof Data_Maybe.Just) {
            var maybeHtmlInput = Web_HTML_HTMLInputElement.fromElement(maybeElement.value0);
            if (maybeHtmlInput instanceof Data_Maybe.Nothing) {
                return Effect_Console.log("x is not input")();
            };
            if (maybeHtmlInput instanceof Data_Maybe.Just) {
                var listener = Web_Event_EventTarget.eventListener(function (v) {
                    return function __do() {
                        var val = Web_HTML_HTMLInputElement.value(maybeHtmlInput.value0)();
                        var parsed = Data_Maybe.fromMaybe(0.0)(parseNumber(val));
                        return Effect_Ref.modify_(function (v1) {
                            return {
                                r: v1.r,
                                y: v1.y,
                                x: parsed
                            };
                        })(appStateRef)();
                    };
                })();
                return $$void(Web_Event_EventTarget.addEventListener("input")(listener)(false)(Web_DOM_Element.toEventTarget(maybeElement.value0)))();
            };
            throw new Error("Failed pattern match at Main (line 73, column 7 - line 80, column 93): " + [ maybeHtmlInput.constructor.name ]);
        };
        throw new Error("Failed pattern match at Main (line 69, column 3 - line 80, column 93): " + [ maybeElement.constructor.name ]);
    };
};
var initRCheckboxes = function (appStateRef) {
    return function (doc) {
        return function __do() {
            var nodeList = Web_DOM_ParentNode.querySelectorAll("input[name=\"r\"]")(Web_DOM_Document.toParentNode(doc))();
            var nodes = Web_DOM_NodeList.toArray(nodeList)();
            var checkboxes = Data_Array.mapMaybe(Web_DOM_Element.fromNode)(nodes);
            Effect_Console.log("\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0447\u0435\u043a\u0431\u043e\u043a\u0441\u043e\u0432 R: " + show(Data_Array.length(checkboxes)))();
            return traverse_(function (cbElement) {
                var maybeHtmlInput = Web_HTML_HTMLInputElement.fromElement(cbElement);
                if (maybeHtmlInput instanceof Data_Maybe.Nothing) {
                    return pure1(Data_Unit.unit);
                };
                if (maybeHtmlInput instanceof Data_Maybe.Just) {
                    return function __do() {
                        var listener = Web_Event_EventTarget.eventListener(function (v) {
                            return function __do() {
                                var isChecked = Web_HTML_HTMLInputElement.checked(maybeHtmlInput.value0)();
                                var maybeVal = Web_DOM_Element.getAttribute("value")(cbElement)();
                                var v1 = bind2(maybeVal)(parseNumber);
                                if (v1 instanceof Data_Maybe.Nothing) {
                                    return Data_Unit.unit;
                                };
                                if (v1 instanceof Data_Maybe.Just) {
                                    return Effect_Ref.modify_(function (st) {
                                        var newR = (function () {
                                            if (isChecked) {
                                                return nub(append1(st.r)([ v1.value0 ]));
                                            };
                                            return Data_Array.filter(function (v2) {
                                                return v2 !== v1.value0;
                                            })(st.r);
                                        })();
                                        return {
                                            x: st.x,
                                            y: st.y,
                                            r: newR
                                        };
                                    })(appStateRef)();
                                };
                                throw new Error("Failed pattern match at Main (line 132, column 11 - line 140, column 28): " + [ v1.constructor.name ]);
                            };
                        })();
                        return $$void(Web_Event_EventTarget.addEventListener("change")(listener)(false)(Web_DOM_Element.toEventTarget(cbElement)))();
                    };
                };
                throw new Error("Failed pattern match at Main (line 126, column 5 - line 141, column 94): " + [ maybeHtmlInput.constructor.name ]);
            })(checkboxes)();
        };
    };
};
var initFormSubmit = function (appStateRef) {
    return function __do() {
        var htmlDoc = bindFlipped(Web_HTML_Window.document)(Web_HTML.window)();
        var maybeForm = Web_DOM_NonElementParentNode.getElementById("point-form")(Web_HTML_HTMLDocument.toNonElementParentNode(htmlDoc))();
        if (maybeForm instanceof Data_Maybe.Nothing) {
            return Effect_Console.log("Form not found")();
        };
        if (maybeForm instanceof Data_Maybe.Just) {
            var listener = Web_Event_EventTarget.eventListener(function (e) {
                return function __do() {
                    $foreign.preventDefault(e)();
                    var state = Effect_Ref.read(appStateRef)();
                    Effect_Console.log("\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0434 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0435\u0439: " + show2(state))();
                    var v = validateState(state);
                    if (v instanceof Data_Either.Left) {
                        Effect_Console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438: " + v.value0)();
                        return $foreign.alert(v.value0)();
                    };
                    if (v instanceof Data_Either.Right) {
                        Effect_Console.log("\u0412\u0430\u043b\u0438\u0434\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435: " + show3(v.value0))();
                        return for_(v.value0.r)(function (rVal) {
                            return function __do() {
                                $foreign.processRequestJS(v.value0.x)(v.value0.y)(rVal)();
                                return Effect_Console.log("\u0412\u044b\u0437\u0432\u0430\u043d processRequestJS \u0441 R=" + show1(rVal))();
                            };
                        })();
                    };
                    throw new Error("Failed pattern match at Main (line 185, column 9 - line 194, column 64): " + [ v.constructor.name ]);
                };
            })();
            return $$void(Web_Event_EventTarget.addEventListener("submit")(listener)(false)(Web_DOM_Element.toEventTarget(maybeForm.value0)))();
        };
        throw new Error("Failed pattern match at Main (line 177, column 3 - line 195, column 87): " + [ maybeForm.constructor.name ]);
    };
};
var main = function __do() {
    var htmlDoc = bindFlipped(Web_HTML_Window.document)(Web_HTML.window)();
    var doc = Web_HTML_HTMLDocument.toDocument(htmlDoc);
    var appStateRef = Effect_Ref["new"]({
        x: 0.0,
        y: Data_Maybe.Nothing.value,
        r: [  ]
    })();
    restoreHistory();
    initXInput(appStateRef)();
    initYButtons(appStateRef)(doc)();
    initRCheckboxes(appStateRef)(doc)();
    initFormSubmit(appStateRef)();
    return Effect_Console.log("\u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f PureScript \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430.")();
};
export {
    alert,
    preventDefault,
    _textContent,
    processRequestJS,
    displayResultInTable,
    processRequestWithResult,
    getItem,
    setItem,
    clearStorage,
    parseResults,
    stringify,
    safeParseAndDisplay
} from "./foreign.js";
export {
    main,
    initXInput,
    initYButtons,
    initRCheckboxes,
    saveResult,
    restoreHistory,
    safeRestoreHistory,
    initFormSubmit,
    validateState,
    parseNumber,
    textContent
};
